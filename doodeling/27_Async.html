<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JavaScript Async</title>
    <style></style>
    <script>
      //Talks to remember:
      //What the heck is the event loop anyway?
      //  https://www.youtube.com/watch?v=8aGhZQkoFbQ
      //Jake Archibald on the web browser event loop
      //  https://www.youtube.com/watch?v=cCOL7MC4Pl0

      // JavaScript's call stack/event loop/callback queue
      // http://latentflip.com/loupe

      //Promise
      //A promise is an object representing the eventual completion
      // or failure of an asynchronous operation.

      //Async function

      //Event loop

      //Callback hell
      //Callback hell is the term for deeply nested and hard-to-read
      // callbacks in JavaScript. It happens when multiple
      // asynchronous tasks rely on previous results, causing
      // code to become increasingly difficult to follow.
      // Modern solutions include Promises or async/await,
      // which help flatten the code and make it more maintainable.

      //--- --- ---

      // const multiply = (x, y) => x * y;
      // const square = x => multiply(x, x);
      // const isRightTriangle = (a, b, c) => {
      //     return square(a) + square(b) === square(c);
      // };
      // console.log(isRightTriangle(3, 4, 5)); // true

      //--- --- ---

      // THE CALLBACK VERSION
      const fakeRequestCallback = (url, success, failure) => {
        const delay = Math.floor(Math.random() * 4500) + 500;
        setTimeout(() => {
          if (delay > 4000) {
            failure("Connection Timeout :(");
          } else {
            success(`Here is your fake data from ${url}`);
          }
        }, delay);
      };

      fakeRequestCallback(
        "books.com",
        (ret) => {
          console.log(ret);
          fakeRequestCallback(
            "books.com/page1",
            (ret) => {
              console.log(ret);
            },
            (ret) => console.log(ret)
          );
        },
        (ret) => console.log(ret)
      );

      //--- --- ---

      // THE PROMISE VERSION
      const fakeRequestPromise = (url) => {
        return new Promise((resolve, reject) => {
          const delay = Math.floor(Math.random() * 4500) + 500;
          setTimeout(() => {
            if (delay > 4000) {
              reject("Connection Timeout :(");
            } else {
              resolve(`Here is your fake data from ${url}`);
            }
          }, delay);
        });
      };
    </script>
  </head>
  <body>
    <script>
      //   const dcc = (color, delay, dccNext) => {
      //     setTimeout(() => {
      //       document.body.style.backgroundColor = `rgb(${color.r}, ${color.g}, ${color.b})`;

      //       color.r = Math.floor(Math.random() * 255) + 1;
      //       color.g = Math.floor(Math.random() * 255) + 1;
      //       color.b = Math.floor(Math.random() * 255) + 1;

      //       dccNext(color, delay, dccNext);
      //     }, delay);
      //   };

      //   dcc({ r: 0, g: 0, b: 0 }, 500, dcc);
    </script>
  </body>
</html>
